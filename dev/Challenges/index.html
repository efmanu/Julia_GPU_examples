<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Challenges in Julia GPU Software Development · Learn to Develop GPU Software with Julia</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Learn to Develop GPU Software with Julia</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><span class="toctext">Getting Started</span><ul><li><a class="toctext" href="../GPU_background/">Some Background on GPUs</a></li><li><a class="toctext" href="../Accessing_GPUs/">Accessing GPUs</a></li><li><a class="toctext" href="../Setup_Julia/">Set-up Julia</a></li></ul></li><li><span class="toctext">Developing With GPUs</span><ul><li><a class="toctext" href="../Vector_addition/">An Introduction to Parallelism</a></li><li><a class="toctext" href="../Vector_dot_product/">Shared Memory and Synchronisation</a></li><li><a class="toctext" href="../Streaming/">Streaming</a></li><li class="current"><a class="toctext" href>Challenges in Julia GPU Software Development</a><ul class="internal"><li class="toplevel"><a class="toctext" href="#isbitstype-1">isbitstype</a></li><li class="toplevel"><a class="toctext" href="#Impenetrable-Error-Messages-1">Impenetrable Error Messages</a></li><li class="toplevel"><a class="toctext" href="#CUDAnative-Does-Not-Support-All-of-Julia-1">CUDAnative Does Not Support All of Julia</a></li></ul></li></ul></li><li><span class="toctext">Performance</span><ul><li><a class="toctext" href="../Profiling/">Profiling</a></li><li><a class="toctext" href="../Performance_thoughts/">Warps and Branching</a></li></ul></li><li><a class="toctext" href="../Further_Reading/">Further Reading</a></li><li><a class="toctext" href="../About_the_author/">About the Author</a></li></ul></nav><article id="docs"><header><nav><ul><li>Developing With GPUs</li><li><a href>Challenges in Julia GPU Software Development</a></li></ul><a class="edit-page" href="github.com/jenni-westoby/Julia_GPU_examples.git"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Challenges in Julia GPU Software Development</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Challenges-in-Julia-GPU-Software-Development-1" href="#Challenges-in-Julia-GPU-Software-Development-1">Challenges in Julia GPU Software Development</a></h1><p>Hopefully I have managed to convince you that developing GPU software with Julia can be a useful thing to do. This section outlines some common challenges and ‘gotchas!’ you might encounter when developing GPU software in Julia.</p><h1><a class="nav-anchor" id="isbitstype-1" href="#isbitstype-1">isbitstype</a></h1><p>Julia makes a distinction between “bits” values and heap allocated “boxed” values. Bits values are stored inline in memory, whereas boxed values contain pointers to objects allocated elsewhere. <code>@cuda</code> only supports the passing of bits values as kernel arguments. This is because bits values are of a fixed, determinate size, so <code>@cuda</code> is able to allocate the correct amount of memory for these values on the device. In contrast, <code>@cuda</code> can’t determine the size of a value with pointers, and so <code>@cuda</code> will throw an error. You can determine whether your values are bits values using the function <code>isbits()</code>, which will return true if your value is bits and false otherwise. Something to be aware of is that strings are not bits values – if you want to work with strings on GPUs you will need to convert your string to an array of chars.</p><h1><a class="nav-anchor" id="Impenetrable-Error-Messages-1" href="#Impenetrable-Error-Messages-1">Impenetrable Error Messages</a></h1><p>When developing GPU software, you will inevitably write kernels with bugs in them. If a bug in your kernel causes the kernel to exit and return an error message, you will often see error messages such as these:</p><pre><code class="language-none">ERROR: LLVM IR generated for Kernel(CuDeviceArray{Int64,1,CUDAnative.AS.Global}) is not GPU compatible</code></pre><p>Or</p><pre><code class="language-none">KernelError: kernel returns a value of type `Union{Nothing, Int64}`
</code></pre><p>The first error message broadly means that you tried to do something which could not compile to GPU code. Common reasons this might happen include:</p><ul><li>You tried to use a Julia feature which is not supported by CUDAnative (see below).</li><li>Your kernel contains unexpected dynamic behavior.</li><li>Your kernel contains type instabilities.</li></ul><p>The second error message indicates that your code compiled successfully (unless it is preceded by the first error message, or another compilation error) but that something went wrong during runtime, hence it returned something other than <code>nothing</code>.</p><p>Unfortunately, you will never see the sort of error message you are probably accustomed to in Julia, where a description of why the code failed to compile or run and a line number are provided. A description of why this is and macros you can use to help debug are described here: http://juliagpu.github.io/CUDAnative.jl/latest/man/troubleshooting.html. In practice, I often debug by iteratively commenting out half of the remaining lines of code in my kernel to identify which line(s) are causing problems.</p><h1><a class="nav-anchor" id="CUDAnative-Does-Not-Support-All-of-Julia-1" href="#CUDAnative-Does-Not-Support-All-of-Julia-1">CUDAnative Does Not Support All of Julia</a></h1><p>This is actually unsurprising when you think about it – Julia is pretty big and CUDAnative is maintained by a relatively small number of people. Plus, actually working out how you would implement support for some of Julia’s features on a GPU is really not trivial.</p><p>Unfortunately, the subset of Julia supported by CUDAnative is undocumented. Some commonly used Julila features not supported by CUDAnative at the time of writing include:</p><ul><li>Strings</li><li>Type conversion</li><li>Recursion</li><li>Exceptions</li><li>Calls to the Julia runtime</li><li>Garbage collection</li></ul><footer><hr/><a class="previous" href="../Streaming/"><span class="direction">Previous</span><span class="title">Streaming</span></a><a class="next" href="../Profiling/"><span class="direction">Next</span><span class="title">Profiling</span></a></footer></article></body></html>
